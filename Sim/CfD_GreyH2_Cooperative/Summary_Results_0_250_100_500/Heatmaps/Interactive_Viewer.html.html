<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GB Energy Sensitivity Analysis Results</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --bg: #f4f7f6;
            --panel-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: var(--bg);
            color: var(--text);
            overflow: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 320px;
            background-color: var(--panel-bg);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .sidebar h2 {
            margin-top: 0;
            color: var(--primary);
            font-size: 1.4rem;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--primary);
        }

        select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            background-color: #fff;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            flex: 1;
            padding: 10px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .file-info {
            margin-top: auto;
            font-size: 0.75rem;
            color: #7f8c8d;
            word-break: break-all;
            background: #eee;
            padding: 10px;
            border-radius: 4px;
        }

        /* Main Content Styling */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        #image-container {
            max-width: 100%;
            max-height: 95%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-radius: 8px;
            overflow: hidden;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #result-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            display: block;
        }

        #error-message {
            display: none;
            color: #c0392b;
            font-size: 1.2rem;
            text-align: center;
            padding: 40px;
        }

        /* Loading Spinner */
        .loading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Dashboard Controls</h2>

        <!-- Configuration based on Python Input -->
        <div class="control-group">
            <label for="h2_type">H2 Production Type</label>
            <small style="color: #666; margin-bottom: 4px;">Set this to match your Python folder (Blue or Grey)</small>
            <select id="h2_type" onchange="updateImage()">
                <option value="BlueH2">Blue Hydrogen</option>
                <option value="GreyH2">Grey Hydrogen</option>
            </select>
        </div>

        <div class="control-group">
            <label for="scenario">Scenario</label>
            <select id="scenario" onchange="updateImage()">
                <option value="Hi_H2">High RES – High H2</option>
                <option value="Lw_H2">High RES – Low H2</option>
            </select>
        </div>

        <div class="control-group">
            <label for="price">Price Case</label>
            <select id="price" onchange="updateImage()">
                <option value="High_Price">High Price</option>
                <option value="Low_Price">Low Price</option>
            </select>
        </div>

        <div class="control-group">
            <label for="metric">Metric / Result</label>
            <select id="metric" onchange="updateImage()">
                <!-- The values here correspond to the file prefixes in Python -->
                <option value="Fig_CfD_support_hyd">CfD Based Support</option>
                <option value="Fig_marg_H2_cost">Marginal Cost of H2</option>
                <option value="Fig_score">Combined Score</option>
                <option value="Fig_emissions">CO2 Emissions</option>
                <option value="Fig_opcost">Operational Cost</option>
                <option value="Fig_opex_support_hyd">Opex-Based Support</option>
                <option value="Fig_NPV">Net Present Value (NPV)</option>
                <option value="Fig_NPV_wo_CfD_H2">NPV without CfD</option>
                <option value="Fig_Total_CfD_cost">Total CfD Cost</option>
                <option value="Fig_green_H2_ratio">Green H2 Ratio</option>
            </select>
        </div>

        <div class="nav-buttons">
            <button onclick="changeMetric(-1)">← Prev Metric</button>
            <button onclick="changeMetric(1)">Next Metric →</button>
        </div>

        <div class="file-info">
            <strong>Looking for file:</strong><br>
            <span id="filepath-display">...</span>
        </div>
    </div>

    <div class="main-content">
        <div class="loading" id="loader"></div>
        <div id="image-container">
            <div id="error-message">
                <strong>Image not found</strong><br><br>
                Please check the "H2 Production Type" setting<br>
                or ensure the Python script completed successfully.
            </div>
            <img id="result-image" src="" alt="Heatmap Result" onload="imageLoaded()" onerror="imageError()">
        </div>
    </div>

    <script>
        // Mappings based on the Python script logic
        const scenarioConfig = {
            "Hi_H2": { folder: "Scenario_High_H2" },
            "Lw_H2": { folder: "Scenario_Low_H2" }
        };

        function getImagePath() {
            const h2Type = document.getElementById('h2_type').value; // BlueH2 or GreyH2
            const scenShort = document.getElementById('scenario').value;
            const priceLabel = document.getElementById('price').value;
            const metricPrefix = document.getElementById('metric').value;

            const scenFolder = scenarioConfig[scenShort].folder;
            
            // Construct Filename
            // Python Logic: f"{PREFIX}_{SCENARIO_SHORT}_{PRICE_LABEL}.png"
            // Special Exception: Green H2 Ratio adds the folder name (BlueH2/GreyH2)
            
            let filename = "";

            if (metricPrefix === "Fig_green_H2_ratio") {
                // Logic: Fig_green_H2_ratio_{SCENARIO_SHORT}_{folder_name}_{price_label}.png
                filename = `${metricPrefix}_${scenShort}_${h2Type}_${priceLabel}.png`;
            } else {
                // Standard Logic
                filename = `${metricPrefix}_${scenShort}_${priceLabel}.png`;
            }

            // Construct Full Relative Path
            // Heatmaps/Scenario_X/High_Price/Filename
            return `${scenFolder}/${priceLabel}/${filename}`;
        }

        function updateImage() {
            const imgPath = getImagePath();
            const imgElement = document.getElementById('result-image');
            const pathDisplay = document.getElementById('filepath-display');
            const errorMsg = document.getElementById('error-message');
            const loader = document.getElementById('loader');

            // Update UI
            pathDisplay.textContent = imgPath;
            errorMsg.style.display = 'none';
            imgElement.style.display = 'none'; // Hide until loaded
            loader.style.display = 'block';

            // Set source
            imgElement.src = imgPath;
        }

        function imageLoaded() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('result-image').style.display = 'block';
        }

        function imageError() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('result-image').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
        }

        function changeMetric(direction) {
            const select = document.getElementById('metric');
            if (direction === 1 && select.selectedIndex < select.options.length - 1) {
                select.selectedIndex++;
            } else if (direction === -1 && select.selectedIndex > 0) {
                select.selectedIndex--;
            }
            updateImage();
        }

        // Initialize on load
        window.onload = updateImage;

        // Add keyboard navigation for quick browsing
        document.addEventListener('keydown', function(event) {
            if(event.key === "ArrowDown") changeMetric(1);
            if(event.key === "ArrowUp") changeMetric(-1);
        });

    </script>
</body>
</html>